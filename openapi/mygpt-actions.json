{
  "openapi": "3.1.0",
  "info": { "title": "Curriculum Actions API", "version": "1.0.0" },
  "servers": [
    { "url": "https://hhlzhoqwlqsiefyiuqmg.functions.supabase.co/functions/v1" }
  ],
  "paths": {
    "/list_contents": {
      "post": {
        "operationId": "listContents",
        "summary": "List content areas",
        "security": [ { "ActionsKeyAuth": [] } ],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "limit":  { "type": "integer", "minimum": 1, "maximum": 200, "default": 50 },
                  "offset": { "type": "integer", "minimum": 0, "default": 0 },
                  "search": { "type": "string" }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Ok",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "ok":    { "type": "boolean" },
                    "count": { "type": "integer" },
                    "items": { "type": "array", "items": { "type": "object", "additionalProperties": true } }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/list_units": {
      "post": {
        "operationId": "listUnits",
        "summary": "List units within a content area",
        "security": [ { "ActionsKeyAuth": [] } ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["content_area"],
                "properties": {
                  "content_area": { "type": "string" },
                  "limit":  { "type": "integer", "minimum": 1, "maximum": 200, "default": 50 },
                  "offset": { "type": "integer", "minimum": 0, "default": 0 },
                  "search": { "type": "string" }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Ok",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "ok":    { "type": "boolean" },
                    "count": { "type": "integer" },
                    "items": { "type": "array", "items": { "type": "object", "additionalProperties": true } }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/list_topics": {
      "post": {
        "operationId": "listTopics",
        "summary": "List topics (optionally by unit; include drafts)",
        "security": [ { "ActionsKeyAuth": [] } ],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "unit_id":        { "type": "string", "format": "uuid" },
                  "include_drafts": { "type": "boolean", "default": false },
                  "limit":          { "type": "integer", "minimum": 1, "maximum": 200, "default": 50 },
                  "offset":         { "type": "integer", "minimum": 0, "default": 0 },
                  "search":         { "type": "string" }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Ok",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "ok":    { "type": "boolean" },
                    "count": { "type": "integer" },
                    "items": { "type": "array", "items": { "type": "object", "additionalProperties": true } }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/get_topic": {
      "post": {
        "operationId": "getTopic",
        "summary": "Get one topic by id",
        "security": [ { "ActionsKeyAuth": [] } ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["topic_id"],
                "properties": {
                  "topic_id": { "type": "string", "format": "uuid" }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Ok",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "ok":    { "type": "boolean" },
                    "topic": { "type": "object", "nullable": true, "additionalProperties": true }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/update_outline": {
      "post": {
        "operationId": "updateOutline",
        "summary": "Save draft or publish (v1/v2)",
        "security": [ { "ActionsKeyAuth": [] } ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "description": "Provide either draft OR publish:true",
                "required": ["topic_id"],
                "properties": {
                  "topic_id": { "type": "string", "format": "uuid" },
                  "draft": { "type": "object", "additionalProperties": true },
                  "publish": { "type": "boolean" },
                  "schema_version": { "type": "integer", "enum": [1, 2], "default": 1 }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Success",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "ok":   { "type": "boolean" },
                    "mode": { "type": "string", "enum": ["draft", "published"] },
                    "schema_version": { "type": "integer", "enum": [1, 2] }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/refine_outline": {
      "post": {
        "operationId": "refineOutline",
        "summary": "Refine an outline and return a draft (v1/v2)",
        "security": [ { "ActionsKeyAuth": [] } ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["topic_id"],
                "properties": {
                  "topic_id": { "type": "string", "format": "uuid" },
                  "schema_version": { "type": "integer", "enum": [1, 2], "default": 1 }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Success",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "ok":    { "type": "boolean" },
                    "draft": { "type": "object", "additionalProperties": true }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "ActionsKeyAuth": {
        "type": "apiKey",
        "in": "header",
        "name": "Authorization"
      }
    },
    "schemas": {}
  }
}