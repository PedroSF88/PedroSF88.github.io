<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Interactive Lessons</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="css/index.css"/>
  <script>
    window.SUPABASE_URL = 'https://hhlzhoqwlqsiefyiuqmg.supabase.co';
    window.SUPABASE_ANON_KEY = 'sb_publishable_z5FpORNEIA4S6kOY-Mdzxw_YtBllO9n';
  </script>
  <style>
    /* Modal slide (4:3) ratio and layout */
    #cardModal .modal-dialog {
      max-width: 1200px;
      width: 98vw;
      aspect-ratio: 16/9;
      margin: auto;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #cardModal .modal-content {
      width: 100%;
      aspect-ratio: 16/9;
      min-height: 0;
      min-width: 0;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: center;
    }
    #cardModal .modal-body {
      flex: 1 1 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 0;
      min-width: 0;
      padding: 2vw;
      overflow-y: auto;
      max-height: 88vh;
    }
    #cardModal .modal-body .card {
      width: 100%;
      max-width: 100%;
      height: auto;
      max-height: 84vh;
      margin: 0 auto;
      transform: scale(1.0);
      display: flex;
      flex-direction: column;
      justify-content: center;
      min-height: 0;
      min-width: 0;
      overflow-y: auto;
    }
    #cardModal .modal-body .vocab-subcard {
      margin: 1rem 0;
      transform: scale(1.0);
    }
    #cardModal .modal-body img {
      max-width: 90%;
      max-height: 70vh;
      display: block;
      margin: 1rem auto;
      object-fit: contain;
    }
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
  <div id="selectedTopicTitle" class="selected-topic-title mb-3"></div>
      <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
        <span></span>
      </button>
  <h5 class="section-title">Units</h5>
  <div id="unitMenu" class="mb-4"></div>
  <h5 class="section-title">Topics</h5>
  <div id="topicMenu" class="mb-4"></div>
    </aside>
    <div class="main">
  <div class="flex-end mb-1rem">
        <button class="btn btn-primary" onclick="window.open('/worksheet_template.html','_blank')">Print Stand-alone Lesson Worksheet</button>
  <button class="btn btn-secondary" id="printVocabBtn">Print Vocab Cards</button>
  <button class="btn btn-secondary" id="printLessonCardsBtn">Print Lesson Cards</button>
  <button class="btn btn-success" id="printStudentWorksheetBtn">Print Student Answer Sheet</button>
      </div>
  <div id="schemaVersionToggle" class="mb-3"></div>
  <div id="cardList"></div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    window.SUPABASE_URL = 'https://hhlzhoqwlqsiefyiuqmg.supabase.co';
    window.SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhobHpob3F3bHFzaWVmeWl1cW1nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1NDgwOTQsImV4cCI6MjA2OTEyNDA5NH0.DnAWm_Ety74vvuRSbiSBZPuD2bCBesiDmNr8wP_mHFQ';
  </script>
  <script src="js/index.js"></script>
  <style>
    @media print {
      .print-vocab-page, .print-lesson-page, .print-student-page { page-break-after: always; break-after: page; }
      body * { visibility: hidden; }
      #printVocabContainer, #printVocabContainer *,
      #printLessonCardsContainer, #printLessonCardsContainer *,
      #printStudentWorksheetContainer, #printStudentWorksheetContainer * { visibility: visible !important; }
      #printVocabContainer, #printLessonCardsContainer, #printStudentWorksheetContainer {
        position: absolute; left: 0; top: 0; width: 100vw; background: white; z-index: 99999;
      }
    }
  </style>
  <div class="modal fade" id="cardModal" tabindex="-1" aria-labelledby="cardModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="cardModalLabel">Card Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="cardModalBody"></div>
      </div>
    </div>
  </div>
</body>
<script>
  const sidebar = document.querySelector('.sidebar');
  const toggleBtn = document.getElementById('sidebarToggle');
  const topicTitle = document.getElementById('selectedTopicTitle');
  toggleBtn.addEventListener('click', () => {
    sidebar.classList.toggle('collapsed');
    // When sidebar is collapsed, show the topic title and hide the menu
    if (sidebar.classList.contains('collapsed')) {
      // Keep topic title hidden unless a topic was selected and explicitly set later
      if (topicTitle.textContent.trim()) {
        topicTitle.style.display = '';
      }
      document.getElementById('unitMenu').style.display = 'none';
      document.getElementById('topicMenu').style.display = 'none';
      document.getElementById('requestMenu').style.display = 'none';
      document.querySelectorAll('.sidebar h5').forEach(h => h.style.display = 'none');
    } else {
  topicTitle.style.display = 'none';
      // Restore all navigation sections/buttons if they exist
      const unitMenu = document.getElementById('unitMenu');
      const topicMenu = document.getElementById('topicMenu');
      const requestMenu = document.getElementById('requestMenu');
      if (unitMenu) {
        unitMenu.style.display = '';
        unitMenu.querySelectorAll('button').forEach(btn => btn.style.display = '');
      }
      if (topicMenu) {
        topicMenu.style.display = '';
        topicMenu.querySelectorAll('button').forEach(btn => btn.style.display = '');
      }
      if (requestMenu) {
        requestMenu.style.display = '';
        requestMenu.querySelectorAll('button').forEach(btn => btn.style.display = '');
      }
      document.querySelectorAll('.sidebar h5').forEach(h => h.style.display = '');
    }
  });
</script>
<!-- DEBUG: Manual modal test button -->
</body>
</html>
